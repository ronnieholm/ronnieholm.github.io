---
layout: post
title: "Creating a reusable backlog list in SharePoint to minimize lead time"
date: 2015-04-29 12:00 UTC
tags: [C#]
---

<!-- 
Create the first part to be copy/pasted to clients (or shown) and
the latter more developer focused for setting up the list
 -->

<div id="post">

<p>
In this post, I'll describe the SharePoint backlog list I use when
working with clients and how to easily re-use it across clients. The
first part shows the backlog and describe the rationale behind it, and
it's the part I use as client documentation. The second part is more
technical and outlines the script to automate setting up the backlog.
</p>

<h2>Motivation</h2>

<p>
Oftentimes clients don't have existing solutions or processes in place
for smaller tasks and tend to default to mail. I prefer a more
transparent and structured approach, such as a SharePoint
list. SharePoint lists are good for creating a simple system for
tracking tasks such as features and defects, and make sure everyone
share a common understanding. Not only of the immidiate task, but its
relative priority, and what constitutes its done-done criteria. With
the backlog, my goal isn't to adhere to a formal process, such as
Scrum, but instead focus
on <a href="http://www.ustream.tv/recorded/6149220">minimizing lead
time to results</a> through simple tools.</p>

<p>
<img src="/content/bugfree-consulting-backlog.png" />
</p>

<p>A few remarks on the design of the backlog list:</p>

<ul>
<li>
I started from the build-in GenericList and not the IssueTracking list
template because I like to kick off with as little baggage as possible
and extend the list rather than trying to figure out how Microsoft
configured IssueTracking and how to remove functionality from it.
</li>
<li>
I strive for as few fields, views, etc. as possible to make usage
intuitive and fast. I simply fallback to using the Comments field for
the few and varying cases not covered by structured fields.
</li>
<li>
Business priority is intended for the business for the business to
priority their tasks. Business isn't a single entity so it should be
viewed together Area. Tasks can then ordered relative to each other
</li>
</ul>

<h2>Technical implementation</h2>

<p>
The problem with a SharePoint list over a spreadsheet is that it
requires a considerable amount of point and clicking setting up in a
new environment, and it may be hard remembering exactly how you setup
everything in previous environment (if you can still access it). First
possible solution would be saving the initial list as a template and
importing in into a new environment. I don't fancy this approach
because actual setup is now opaque and a template cannot necessarily
be imported across versions of SharePoint. Second possible solution is
document in Word form all the setup steps, but that's just mindless
duplicate effort which quickly grows stale.
</p>

<p>
My preferred solution to re-creating artefacts across SharePoint
instances is scripting. For the exact reason that it makes the whole
setup transparent and easy to make small local adjustments. For
scripting I tend to go with console applications as Visual Studio is
always readily available.
</p>

<p>
Let's start by established a container to insert code into. This
script is intended to be run against SharePoint Online but with minor
modifications to the SetupContext methods it can target recent
SharePoint on-prem versions as well.
</p>

<p>
While it may seem a lot of code, it's really just standard
authentication code and the same XML adjusted for variations in field
types. The easiest way to get at this XML is configuring the field
through the browser and then use a tool
like <a href="http://spcb.codeplex.com">SharePoint 2013 Client
Browser</a> to browse the client-side object model and extract the
proper XML to be parameterized.
</p>

<pre class="prettyprint lang-cs">
// add reference to:
//   C:\Program Files\Common Files\microsoft shared\Web Server Extensions\16\ISAPI\Microsoft.SharePoint.Client.dll
//   C:\Program Files\Common Files\microsoft shared\Web Server Extensions\16\ISAPI\Microsoft.SharePoint.Client.Runtime.dll

using Microsoft.SharePoint.Client;
using System;
using System.Linq;
using System.Security;
using System.Text;
using System.Xml.Linq;
using E = System.Xml.Linq.XElement;
using A = System.Xml.Linq.XAttribute;

namespace BugfreeConsultingBacklog {
    class Program {
        static ClientContext SetupContext(Uri siteCollection) {
            var user = "ronnieholm@bugfree.onmicrosoft.com";
            var password = "password";
            var securePassword = new SecureString();
            password.ToCharArray().ToList().ForEach(securePassword.AppendChar);
            var credentials = new SharePointOnlineCredentials(user, securePassword);
            return new ClientContext(siteCollection) { Credentials = credentials };
        }

        static XElement CreateNoteField(string internalName, string displayName, bool appendOnly = false) {
            return
                new E("Field",
                    new A("Type", "Note"),
                    new A("DisplayName", displayName),
                    new A("Required", "FALSE"),
                    new A("EnforceUniqueValues", "FALSE"),
                    new A("Indexed", "FALSE"),
                    new A("NumLines", "6"),
                    new A("RichText", "FALSE"),
                    new A("Sortable", "FALSE"),
                    new A("ID", Guid.NewGuid()),
                    new A("StaticName", internalName),
                    new A("Name", internalName),
                    new A("AppendOnly", appendOnly));
        }

        static XElement CreateTextField(string internalName, string displayName) {
            return
                new E("Field",
                    new A("Type", "Text"),
                    new A("DisplayName", displayName),
                    new A("Description", ""),
                    new A("Required", "FALSE"),
                    new A("EnforceUniqueValues", "FALSE"),
                    new A("Indexed", "FALSE"),
                    new A("MaxLength", "255"),
                    new A("ID", Guid.NewGuid()),
                    new A("StaticName", internalName),
                    new A("Name", internalName));
        }

        static XElement CreateNumberField(string internalName, string displayName) {
            return
                new E("Field",
                    new A("Type", "Number"),
                    new A("DisplayName", displayName),
                    new A("Required", "FALSE"),
                    new A("EnforceUniqueValues", "FALSE"),
                    new A("Indexed", "FALSE"),
                    new A("ID", Guid.NewGuid()),
                    new A("StaticName", internalName),
                    new A("Name", internalName));
        }

        static XElement CreateChoiceField(string internalName, string displayName, string[] choices, string defaultChoice) {
            var choicesElement = new E("CHOICES");
            choices.ToList().ForEach(c => choicesElement.Add(new E("CHOICE", c)));

            return 
                new E("Field",
                    new A("Type", "Choice"),
                    new A("DisplayName", displayName),
                    new A("Description", ""),
                    new A("Required", "FALSE"),
                    new A("EnforceUniqueValues", "FALSE"),
                    new A("Indexed", "FALSE"),
                    new A("Format", "Dropdown"),
                    new A("FillInChoice", "FALSE"),
                    new A("ID", Guid.NewGuid()),
                    new A("StaticName", internalName),
                    new A("Name", internalName),
                    new E("Default", defaultChoice),
                    choicesElement);
        }

        static XElement CreateUserField(string internalName, string displayName) {
            return
                new E("Field",
                    new A("Type", "User"),
                    new A("DisplayName", displayName),
                    new A("Description", ""),
                    new A("List", "UserInfo"),
                    new A("Required", "FALSE"),
                    new A("EnforceUniqueValues", "FALSE"),
                    new A("ShowField", "ImnName"),
                    new A("UserSelectionMode", "PeopleOnly"),
                    new A("UserSelectionScope", "0"),
                    new A("ID", Guid.NewGuid()),
                    new A("StaticName", internalName),
                    new A("Name", internalName));
        }

        static void Main(string[] args) {
            using (var ctx = SetupContext(new Uri("https://baneudv.sharepoint.com/sites/rh-test-english"))) {
                // code below goes here.
            }
        }
    }
}
</pre>

<p>
With the helper routines out of our way, here's the main script:
</p>

<pre class="prettyprint lang-cs">
var backlog = ctx.Web.Lists.Add(new ListCreationInformation {
    Title = "BugfreeConsultingBacklog",
    TemplateType = (int)ListTemplateType.GenericList
});

ctx.Load(backlog, l => l.Fields, l => l.DefaultView);
backlog.Title = "Bugfree Consulting Backlog";
backlog.EnableVersioning = true;
backlog.Update();
ctx.ExecuteQuery();

new[] {
    CreateNoteField("Description", "Description"),
    CreateNoteField("HowToTest", "How to test"),
    CreateNumberField("BusinessPriority", "Business priority"),
    CreateChoiceField("Classification", "Classification", new[] { "Change", "Defect" }, ""),
    CreateTextField("Area", "Area"),
    CreateUserField("AssignedTo", "Assigned to"),
    CreateUserField("BusinessContact", "Business contact"),
    CreateChoiceField(
        "Status", 
        "Status", 
        new[] 
        { 
            "Received", 
            "Needs clarification", 
            "Ready for development", 
            "Under development", 
            "Development completed", 
            "Blocked", 
            "Ready for test", 
            "Test succeeded", 
            "Test failed", 
            "Completed", 
            "Closed" 
        },
        "Received"),
    CreateNumberField("OriginalEstimate", "Original estimate"),
    CreateNumberField("RemainingEstimate", "Remaining estimate"),
    CreateNoteField("Comments", "Comments", true),
}
.ToList()
.ForEach(schema => backlog.Fields.AddFieldAsXml(schema.ToString(), false, AddFieldOptions.DefaultValue));
ctx.ExecuteQuery();

var comments = ctx.CastTo<FieldMultiLineText>(backlog.Fields.GetByTitle("Comments"));
ctx.Load(comments);
ctx.ExecuteQuery();
comments.AppendOnly = true;
comments.Update();
                
backlog.DefaultView.DeleteObject();
ctx.ExecuteQuery();

var newView = backlog.Views.Add(new ViewCreationInformation
{
    Title = "AllItems",
    ViewFields = new[] { 
        "ID", "LinkTitle", "Area", "AssignedTo", "Classification", 
        "BusinessPriority", "Status", "OriginalEstimate", "RemainingEstimate"
    },
    SetAsDefaultView = true,
    Paged = true
});
newView.Title = "All Items";
newView.Update();
ctx.ExecuteQuery();
</pre>

<h2>Conclusion</h2>

<p>
xx
</p>

</div>
